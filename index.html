
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>What Moves Markets?</title><meta name="generator" content="MATLAB 9.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2022-03-10"><meta name="DC.source" content="index.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>What Moves Markets?</h1><!--introduction--><p>This page gives a basic overview of the event database from the paper "What Moves Markets?" by Mark Kerssenfischer and Maik Schmeling</p><p>Notes:</p><div><ul><li>All intraday timestamps refer to Greenwich Mean Time (GMT), i.e without daylight saving time offset</li><li>The database currently contains three types of events: 1) auctions, 2) central bank announcements and 3) ad hoc events. Auctions include announcements and results for the US and Germany and are taken from the websites of the US Treasury and the German Finance Agency. Central bank announcements cover eight major central banks. Ad hoc events include natural catastophies, rating events, etc.</li><li>The database does currently not contain events from Bloomberg, such as macroeconomic data releases and auctions in France, Italy and Spain</li></ul></div><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">Data Format</a></li><li><a href="#3">Number of Events by Type</a></li><li><a href="#4">Number of Events by Subtype</a></li><li><a href="#5">Events over Time</a></li><li><a href="#6">Central Bank Announcements over Time</a></li><li><a href="#7">Central Bank Announcements by Intraday Time</a></li><li><a href="#8">Types of Announcements by Intraday Time for each Central Bank</a></li></ul></div><h2 id="2">Data Format</h2><p>display first event of each type</p><pre class="codeoutput">       eventstart           eventend            type                   subtype                       subsubtype                                                                                                         description                                                                                                                                                                              source                                                                                scheduled
    ________________    ________________    ____________    ______________________________    ________________________    _______________________________________________________________________________________________________________________________________________________________________________________________________    ______________________________________________________________________________________________________________________________________________________________    _________

    04.03.2002 16:30                 NaT    Auction         US Announcement                   Bill                        CUSIP 912795JN2                                                                                                                                                                                            "https://www.treasurydirect.gov/instit/annceresult/press/press.htm"                                                                                                 true   
    05.03.2002 05:00                 NaT    Central Bank    BoJ                               Minutes                     Minutes on January 15/16 Meeting                                                                                                                                                                           ""                                                                                                                                                                  true   
    05.03.2002 14:00                 NaT    Central Bank    BoC                               Press Release               -                                                                                                                                                                                                          ""                                                                                                                                                                  true   
    05.03.2002 18:00                 NaT    Auction         US Result                         Bill                        CUSIP 912795JN2                                                                                                                                                                                            "https://www.treasurydirect.gov/instit/annceresult/press/press.htm"                                                                                                 true   
    05.03.2002 22:30                 NaT    Central Bank    RBA                               Press Release               -                                                                                                                                                                                                          ""                                                                                                                                                                  true   
    06.03.2002 19:00                 NaT    Central Bank    Fed                               Beige Book                  Beige Book Release                                                                                                                                                                                         ""                                                                                                                                                                  true   
    07.03.2002 12:00                 NaT    Central Bank    BoE                               Press Release               MPD                                                                                                                                                                                                        ""                                                                                                                                                                  true   
    07.03.2002 12:45                 NaT    Central Bank    ECB                               Press Release               GCM PR: no change                                                                                                                                                                                          ""                                                                                                                                                                  true   
    07.03.2002 13:30    07.03.2002 14:08    Central Bank    ECB                               Press Conference            GCM PC                                                                                                                                                                                                     ""                                                                                                                                                                  true   
    07.03.2002 15:00    07.03.2002 17:35    Central Bank    Fed                               Speech by Chair             Greenspan Senate Testimony (Monetary Policy Report)                                                                                                                                                        "https://www.govinfo.gov/content/pkg/CHRG-107shrg80301/pdf/CHRG-107shrg80301.pdf"                                                                                   true   
    14.03.2002 09:00                 NaT    Central Bank    ECB                               Economic Bulletin           Monthly Bulletin                                                                                                                                                                                           ""                                                                                                                                                                  true   
    19.03.2002 08:00                 NaT    Central Bank    Riksbank                          Press Release               Repo Rate Decision: 25bp hike to 4.0 percent                                                                                                                                                               ""                                                                                                                                                                  true   
    19.03.2002 19:15                 NaT    Central Bank    Fed                               Press Release               FOMC Statement: Rates unchanged                                                                                                                                                                            ""                                                                                                                                                                  true   
    20.03.2002 04:35                 NaT    Central Bank    BoJ                               Press Release               BoJ: MP unchanged. The Bank of Japan will conduct money market operations, aiming at the outstanding balance of the current accounts at the Bank at around 10 to 15 trillion yen.                          ""                                                                                                                                                                  true   
    20.03.2002 09:30                 NaT    Central Bank    BoE                               Minutes                     Minutes                                                                                                                                                                                                    ""                                                                                                                                                                  true   
    20.03.2002 19:30                 NaT    Auction         US Announcement                   Note                        CUSIP 912828AA8                                                                                                                                                                                            "https://www.treasurydirect.gov/instit/annceresult/press/press.htm"                                                                                                 true   
    21.03.2002 13:00                 NaT    Central Bank    SNB                               Press Release               Unchanged monetary policy - target range for the three-month Libor rate remains at 1.25%-2.25%                                                                                                             "https://www.snb.ch/en/mmr/reference/pre_20020321/source/pre_20020321.en.pdf"                                                                                       true   
    21.03.2002 19:00                 NaT    Central Bank    Fed                               Minutes                     FOMC Meeting Minutes                                                                                                                                                                                       ""                                                                                                                                                                  true   
    22.03.2002 05:00                 NaT    Central Bank    BoJ                               Monthly Report              Monthly Report of Recent Economic and Financial Developments: The Bank's View                                                                                                                              ""                                                                                                                                                                  true   
    27.03.2002 18:00                 NaT    Auction         US Result                         Note                        CUSIP 912828AA8                                                                                                                                                                                            "https://www.treasurydirect.gov/instit/annceresult/press/press.htm"                                                                                                 true   
    29.03.2002 19:00                 NaT    Central Bank    Fed                               Discount Rate Minutes       Discount Rate Minutes                                                                                                                                                                                      ""                                                                                                                                                                  true   
    08.04.2002 09:00                 NaT    Central Bank    Riksbank                          Minutes                     Minutes from 18 March 2002                                                                                                                                                                                 ""                                                                                                                                                                  true   
    18.04.2002 15:48    18.04.2002 16:45    Ad Hoc          Other Unscheduled Event           -                           An airplane crashes into a skyscraper in Milan, Italy, raising fears of a terrorist attack because of the similarities with the 9/11 attacks.                                                              "https://en.wikipedia.org/wiki/2002_Pirelli_Tower_airplane_crash"                                                                                                   false  
    19.04.2002 11:45                 NaT    Central Bank    ECB                               Speech by President         Duisenberg: Some remarks on the euro  in a US context                                                                                                                                                      "ECB/Bloomberg"                                                                                                                                                     false  
    26.04.2002 08:00                 NaT    Central Bank    Riksbank                          Press Conference            PC                                                                                                                                                                                                         ""                                                                                                                                                                  true   
    15.05.2002 09:30    15.05.2002 10:30    Central Bank    BoE                               Inflation Reports           Quarterly Inflation Report                                                                                                                                                                                 ""                                                                                                                                                                  true   
    14.06.2002 08:00    14.06.2002 09:30    Central Bank    SNB                               Press Conference            PC                                                                                                                                                                                                         ""                                                                                                                                                                  true   
    20.09.2002 10:00                 NaT    Central Bank    BoE                               Speech by Governor          George: "there is a reasonable prospect that global demand will pick up gradually"                                                                                                                         "https://www.bankofengland.co.uk/-/media/boe/files/speech/2002/edward-george-west-midlands-conference.pdf?la=en&amp;hash=06AFC3A65579A2E1253CD99C6EACAC61972A5736"      false  
    22.09.2002 16:00                 NaT    Ad Hoc          Iraq War                          -                           Having voiced strong anti-war views during the campaign, Gerhard Schroeder wins German election.                                                                                                           "Wolfers &amp; Zitzewitz (2009)"                                                                                                                                        false  
    24.10.2002 12:36    24.10.2002 13:30    Central Bank    ECB                               Ad Hoc Press Release        PR: ECB to make stability pact statement; "Problems have arisen not because the rules are inflexible, but as a result of some countries' unwillingness to honour their commitment to respect the rules"    "https://www.ecb.europa.eu/press/pr/date/2002/html/pr021024_1.en.html"                                                                                              false  
    26.10.2002 16:00                 NaT    Central Bank    ECB                               Statement by GC member      Bundesbank's Welteke in Spiegel interview: political pressure on ECB make rate cut harder                                                                                                                  ""                                                                                                                                                                  false  
    30.10.2002 05:45                 NaT    Central Bank    BoJ                               Ad Hoc Press Release        MP eased. CAB increased to &yen;15-20 tr                                                                                                                                                                       ""                                                                                                                                                                  false  
    19.12.2002 11:17                 NaT    Auction         German Issuance Plan              -                           Release of Yearly Issuance Plan                                                                                                                                                                            "http://www.deutsche-finanzagentur.de/de/institutionelle-investoren/primaermarkt/auktionsergebnisse/"                                                               true   
    17.03.2003 17:15                 NaT    Central Bank    SNB                               Speech by Chair             Roth: "We can raise liquidity in the system also in case of interest rates at 0%"                                                                                                                          ""                                                                                                                                                                  false  
    17.07.2003 06:00    17.07.2003 07:00    Central Bank    BoJ                               Press Conference            Bank of Japan Governor Fukui Speaks at Press Conference                                                                                                                                                    ""                                                                                                                                                                  true   
    24.09.2003 12:02                 NaT    Ad Hoc          OPEC                              -                           OPEC meeting: cut production by 0,9 mbpd                                                                                                                                                                   "https://global.factiva.com/redir/default.aspx?P=sa&amp;an=LBA0000020030924dz9o001jv&amp;cat=a&amp;ep=ASE"                                                                      false  
    22.07.2004 15:00                 NaT    Auction         US Announcement                   Bond                        CUSIP 912810FR4                                                                                                                                                                                            "https://www.treasurydirect.gov/instit/annceresult/press/press.htm"                                                                                                 true   
    27.07.2004 17:00                 NaT    Auction         US Result                         Bond                        CUSIP 912810FR4                                                                                                                                                                                            "https://www.treasurydirect.gov/instit/annceresult/press/press.htm"                                                                                                 true   
    05.01.2005 10:05                 NaT    Auction         German Result                     Note                        ISIN DE0001135267                                                                                                                                                                                          "http://www.deutsche-finanzagentur.de/de/institutionelle-investoren/primaermarkt/auktionsergebnisse/"                                                               true   
    10.01.2005 10:05                 NaT    Auction         German Result                     Bill                        ISIN DE0001114759                                                                                                                                                                                          "http://www.deutsche-finanzagentur.de/de/institutionelle-investoren/primaermarkt/auktionsergebnisse/"                                                               true   
    26.01.2005 10:05                 NaT    Auction         German Result                     Bond                        ISIN DE0001135275                                                                                                                                                                                          "http://www.deutsche-finanzagentur.de/de/institutionelle-investoren/primaermarkt/auktionsergebnisse/"                                                               true   
    02.05.2006 10:47                 NaT    Ad Hoc          Sovereign Credit Ratings          -                           Fitch Upgrade and stable outlook for Belgium                                                                                                                                                               ""                                                                                                                                                                  false  
    09.01.2007 08:00                 NaT    Central Bank    SNB                               Quarterly Bulletin          Quarterly Bulletin (Monetary Policy Report - Economic Situation)                                                                                                                                           ""                                                                                                                                                                  true   
    24.07.2007 12:05                 NaT    Ad Hoc          Global Financial Crisis           -                           Countrywide Financial Corporation warns of &#8220;difficult conditions.&#8221;                                                                                                                                         "Cayon et al. (2014)"                                                                                                                                               false  
    17.08.2007 12:30                 NaT    Central Bank    Fed                               Ad Hoc Press Release        Federal Reserve Board Statement: reduce primary credit rate from 6.25% to 5.75%; allow the provision of term financing for as long as 30 days, renewable by the borrower                                   ""                                                                                                                                                                  false  
    11.03.2008 11:00                 NaT    Central Bank    BoE                               Ad Hoc Press Release        PR: continuation of expanded 3-month long term repo open market operations against a wider range of high quality collateral                                                                                "http://web-old.archive.org/web/20120803145615/http://www.bankofengland.co.uk/markets/Documents/money/documentation/announcement080311.pdf"                         false  
    14.07.2009 09:53    14.07.2009 10:04    Ad Hoc          European Sovereign Debt Crisis    -                           In comments to the press, Irish CB chief John Hurley warned that taxpayer would have to take a hit in purchasing loans from the banks in order to help restore financial stability.                        "Bahaj (2019)"                                                                                                                                                      false  
    12.08.2010 08:28                 NaT    Central Bank    BoJ                               Speech by Governor          Shirakawa: There are substantial fluctuations in the foreign exchange and stock markets. BoJ will carefully monitor such developments                                                                      ""                                                                                                                                                                  false  
    27.04.2011 18:15    27.04.2011 19:15    Central Bank    Fed                               Press Conference            FOMC Press Conference                                                                                                                                                                                      ""                                                                                                                                                                  true   
    28.06.2013 12:00                 NaT    Central Bank    Fed                               Statement by FOMC member    Stein: "economic fundamentals have improved since start of QE3"                                                                                                                                            "https://www.federalreserve.gov/newsevents/speech/stein20130628a.htm"                                                                                               false  
    19.02.2015 12:30                 NaT    Central Bank    ECB                               Accounts                    Monetary Policy Accounts                                                                                                                                                                                   ""                                                                                                                                                                  true   
    06.08.2015 11:00    06.08.2015 11:45    Central Bank    BoE                               Press Conference            MPD, Minutes, Inflation report (first "Super Thursday")                                                                                                                                                    ""                                                                                                                                                                  true   
    07.01.2016 23:50                 NaT    Central Bank    BoJ                               Summary of Opinions         Summary of Opinions                                                                                                                                                                                        ""                                                                                                                                                                  true   
    04.12.2016 22:23                 NaT    Ad Hoc          Trump                             -                           Tweet: Did China ask us if it was OK to devalue their currency (making it hard for our companies to compete) heavily tax our products going into..                                                         "Twitter for Android"                                                                                                                                               false  
    31.01.2020 17:36                 NaT    Ad Hoc          Covid-19                          -                           Trump Weighs Tighter China Travel Restrictions In Response To Coronavirus - Washington Post                                                                                                                "Trump Weighs Tighter China Travel Restrictions In Response To Coronavirus - Washington Post"                                                                       false  

</pre><h2 id="3">Number of Events by Type</h2><pre class="codeoutput">    Auction    Central Bank    Ad Hoc    Total
    _______    ____________    ______    _____

     10471         4540         1165     16176

</pre><h2 id="4">Number of Events by Subtype</h2><p>For each type of event, show a "treemap" of subtypes and, if available, subsubtypes. The areas correspond to the number of events.</p><pre class="codeoutput">|||||||||||||||||||||||||||||||||||||||||||||||||| Event Type: Ad Hoc ||||||||||||||||||||||||||||||||||||||||||||||||||
</pre><img vspace="5" hspace="5" src="index_01.png" alt=""> <pre class="codeoutput">|||||||||||||||||||||||||||||||||||||||||||||||||| Event Type: Auction ||||||||||||||||||||||||||||||||||||||||||||||||||
</pre><img vspace="5" hspace="5" src="index_02.png" alt=""> <img vspace="5" hspace="5" src="index_03.png" alt=""> <pre class="codeoutput">|||||||||||||||||||||||||||||||||||||||||||||||||| Event Type: Central Bank ||||||||||||||||||||||||||||||||||||||||||||||||||
</pre><img vspace="5" hspace="5" src="index_04.png" alt=""> <img vspace="5" hspace="5" src="index_05.png" alt=""> <h2 id="5">Events over Time</h2><pre class="codeoutput">Number of monthly events for each type:
</pre><img vspace="5" hspace="5" src="index_06.png" alt=""> <pre class="codeoutput">Number of quarterly events for each subtype:
</pre><img vspace="5" hspace="5" src="index_07.png" alt=""> <img vspace="5" hspace="5" src="index_08.png" alt=""> <img vspace="5" hspace="5" src="index_09.png" alt=""> <h2 id="6">Central Bank Announcements over Time</h2><p>number of quarterly events for each central bank</p><img vspace="5" hspace="5" src="index_10.png" alt=""> <img vspace="5" hspace="5" src="index_11.png" alt=""> <img vspace="5" hspace="5" src="index_12.png" alt=""> <img vspace="5" hspace="5" src="index_13.png" alt=""> <img vspace="5" hspace="5" src="index_14.png" alt=""> <img vspace="5" hspace="5" src="index_15.png" alt=""> <img vspace="5" hspace="5" src="index_16.png" alt=""> <img vspace="5" hspace="5" src="index_17.png" alt=""> <h2 id="7">Central Bank Announcements by Intraday Time</h2><p>number of events by hour of the day</p><img vspace="5" hspace="5" src="index_18.png" alt=""> <h2 id="8">Types of Announcements by Intraday Time for each Central Bank</h2><p>number of events by hour of the day</p><img vspace="5" hspace="5" src="index_19.png" alt=""> <img vspace="5" hspace="5" src="index_20.png" alt=""> <img vspace="5" hspace="5" src="index_21.png" alt=""> <img vspace="5" hspace="5" src="index_22.png" alt=""> <img vspace="5" hspace="5" src="index_23.png" alt=""> <img vspace="5" hspace="5" src="index_24.png" alt=""> <img vspace="5" hspace="5" src="index_25.png" alt=""> <img vspace="5" hspace="5" src="index_26.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2021b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% What Moves Markets?
% This page gives a basic overview of the event database from
% the paper "What Moves Markets?" by Mark Kerssenfischer 
% and Maik Schmeling
%
% Notes:
%
% * All intraday timestamps refer to Greenwich Mean Time (GMT), i.e without 
% daylight saving time offset
% * The database currently contains three types of events: 1) auctions,
% 2) central bank announcements and 3) ad hoc events.
% Auctions include announcements and results for the US and Germany and are 
% taken from the websites of the US Treasury and the German Finance Agency.
% Central bank announcements cover eight major central banks. 
% Ad hoc events include natural catastophies, rating events, etc.
% * The database does currently not contain events from Bloomberg, such as 
% macroeconomic data releases and auctions in France, Italy and Spain

%%
clear
% load event database
load('WhatMovesMarkets_eventdatabase.mat')

% colors
tempcol = lines(7);
tempcol(8,:) = repmat(.7,1,3);
% central bank list
cblist = unique(Tevents.subtype(strcmp(Tevents.type,'Central Bank')));
cblist = cblist([5 4 2 3 7 8 1 6]);
% figure size in cm
figsiz = [16 9];

%% Data Format
% display first event of each type
fieldlist = {'type','subtype','subsubtype','description','source'};% to avoid " symbols, convert strings to categorical
for i=1:length(fieldlist)
    Tevents.(fieldlist{i}) = categorical(Tevents.(fieldlist{i}));
    Tevents.(fieldlist{i}) = fillmissing(Tevents.(fieldlist{i}), 'constant', '-');
end
%disp(Tevents(1:10,:));

[~,ia] = unique(timetable2table(Tevents(:,{'type','subtype','subsubtype'}),"ConvertRowTimes",false),'rows');
disp(sortrows(Tevents(ia,:)));
load('WhatMovesMarkets_eventdatabase.mat')

%% Number of Events by Type
% 
tbl = tabulate(Tevents.type);
tbl = array2table(cell2mat(tbl(:,2))','VariableNames',tbl(:,1));
tbl.Total = sum(tbl{:,:});
disp(tbl); 

%% Number of Events by Subtype
% For each type of event, show a "treemap" of subtypes and, if available, 
% subsubtypes. The areas correspond to the number of events.
listi = unique(Tevents.type)';
for i=1:length(listi)
    fprintf('%s Event Type: %s %s\n',repmat('|',1,50),listi(i),repmat('|',1,50))
    tbl = tabulate(Tevents.subtype(strcmp(Tevents.type,listi(i))));
    tbl = array2table(cell2mat(tbl(:,2)),'RowNames',tbl(:,1));
    tbl = sortrows(tbl,'Var1','descend');
    
    rectangles = treemap(tbl{:,:},16,9);    
    % translate rectangles to relative units
    rectangles([1 3],:) = rectangles([1 3],:)/16;
    rectangles([2 4],:) = rectangles([2 4],:)/9;
    figure;
    outline(rectangles)    
    plotRectangles(rectangles,strcat(tbl.Properties.RowNames,{': '},num2str(tbl{:,:})),tempcol)
    set(gcf,'Units','centimeters', 'Position', [0 0 figsiz],'PaperUnits','centimeters','PaperSize',figsiz)
    snapnow;
    if i>1
    %fprintf('Further split by subsubtype:\n')
        figure
        listii = tbl.Properties.RowNames;
        for ii=1:length(listii)
            if any(~strcmp(Tevents.subsubtype(strcmp(Tevents.type,listi(i)) & strcmp(Tevents.subtype,listii(ii))),"")) 
                tbl = tabulate(Tevents.subsubtype(strcmp(Tevents.type,listi(i)) & strcmp(Tevents.subtype,listii(ii))));
                tbl = array2table(cell2mat(tbl(:,2)),'RowNames',tbl(:,1));
                tbl = sortrows(tbl,'Var1','descend');
                rNew = treemap(tbl{:,:},rectangles(3,ii),rectangles(4,ii));
                % position rectangle within rectangle
                rNew(1,:) = rNew(1,:) + rectangles(1,ii);
                rNew(2,:) = rNew(2,:) + rectangles(2,ii);
                outline(rNew)    
                plotRectangles(rNew,tbl.Properties.RowNames,repmat(tempcol(ii,:),size(tbl,1),1))
            end
        end
        set(gcf,'Units','centimeters', 'Position', [0 0 figsiz],'PaperUnits','centimeters','PaperSize',figsiz)
        snapnow;
    end
end
close all

%% Events over Time
fprintf('Number of monthly events for each type:\n')
eventtypes = unique(Tevents.type);
figure
hold on
for i=1:length(eventtypes)
    [ia,~,ic] = unique(dateshift(Tevents.eventstart(strcmp(Tevents.type,eventtypes{i})),'start','month'));
    plot(ia,accumarray(ic,1),'LineWidth',2)
    grid on
end
set(gcf,'Units','centimeters', 'Position', [0 0 figsiz],'PaperUnits','centimeters','PaperSize',figsiz)
legend(eventtypes,'Location','SouthOutside','Orientation','Horizontal')
snapnow;

fprintf('Number of quarterly events for each subtype:\n')
subtypes = cell(1,length(eventtypes));
for i=1:length(eventtypes)
    Tsubtyp = timetable('RowTimes',unique(dateshift(Tevents.eventstart,'start','quarter')));
    subtypes = unique(Tevents.subtype(strcmp(Tevents.type,eventtypes{i})));    
    for ii=1:length(subtypes)
        [ia,~,ic] = unique(dateshift(Tevents.eventstart(strcmp(Tevents.type,eventtypes{i}) & ...
            strcmp(Tevents.subtype,subtypes{ii})),'start','quarter'));
        Tsubtyp = outerjoin(Tsubtyp,array2timetable(accumarray(ic,1),'RowTimes',ia,'VariableNames',subtypes(ii)));
    end
    figure;
    h = bar(1:size(Tsubtyp,1),Tsubtyp{:,:},1,'stacked','LineStyle','none');
    set(h, {'FaceColor'}, num2cell(tempcol(1:length(subtypes),:),2));    
    grid on    
    % label all even years
    ind = find(Tsubtyp.Time.Month==1 & mod(Tsubtyp.Time.Year,2)==0);
    xticks(ind)
    xticklabels(Tsubtyp.Time.Year(ind))    
    legend(subtypes,'Location','EastOutside','NumColumns',1)
    title(sprintf('%s',eventtypes{i}))
    set(gcf,'Units','centimeters', 'Position', [0 0 figsiz],'PaperUnits','centimeters','PaperSize',figsiz)
end


%% Central Bank Announcements over Time
% number of quarterly events for each central bank

for i=1:length(cblist)
    Tcb = timetable('RowTimes',unique(dateshift(Tevents.eventstart,'start','quarter')));  
    subsubtypes = unique(Tevents.subsubtype(strcmp(Tevents.subtype,cblist{i})));    
    for ii=1:length(subsubtypes)        
        [ia,~,ic] = unique(dateshift(Tevents.eventstart(strcmp(Tevents.subtype,cblist{i}) & strcmp(Tevents.subsubtype,subsubtypes{ii})),'start','quarter'));
       
        Tcb = outerjoin(Tcb,array2timetable(accumarray(ic,1),'RowTimes',ia,'VariableNames',subsubtypes(ii)));
    end
    figure;    
    h = bar(1:size(Tcb,1),Tcb{:,:},1,'stacked','LineStyle','none');
    ylim([0 max(ylim)+2])
    set(h, {'FaceColor'}, num2cell(tempcol(1:length(subsubtypes),:),2));    
    grid on
    % label all even years
    ind = find(Tcb.Time.Month==1 & mod(Tcb.Time.Year,2)==0);
    xticks(ind)
    xticklabels(Tcb.Time.Year(ind))    
    legend(subsubtypes,'Location','EastOutside','NumColumns',1)
    title(cblist{i})
    set(gcf,'Units','centimeters', 'Position', [0 0 figsiz],'PaperUnits','centimeters','PaperSize',figsiz)
end

%% Central Bank Announcements by Intraday Time
% number of events by hour of the day

Tcb_t = timetable('RowTimes',duration(unique(Tevents.eventstart.Hour),0,0));

for i=1:length(cblist)
    [ia,~,ic] = unique(Tevents.eventstart.Hour(strcmp(Tevents.type,'Central Bank') & ...
        strcmp(Tevents.subtype,cblist{i})));
    Tcb_t = outerjoin(Tcb_t,array2timetable(accumarray(ic,1),'RowTimes',duration(ia,0,0),'VariableNames',cblist(i)));
end
figure;
h = bar(hour(Tcb_t.Time),Tcb_t{:,:},1,'stacked','LineStyle','none');
set(h, {'FaceColor'}, num2cell(tempcol(1:length(cblist),:),2));    
grid on    
legend(cblist,'Location','EastOutside','NumColumns',1)
title('Intraday Times of Central Bank Events')
set(gcf,'Units','centimeters', 'Position', [0 0 figsiz],'PaperUnits','centimeters','PaperSize',figsiz)
xticks(0:1:23)
xlabel('Hour of Day (GMT)')

%% Types of Announcements by Intraday Time for each Central Bank
% number of events by hour of the day
for j=1:length(cblist)
    
Tcb_t = Tevents(strcmp(Tevents.type,'Central Bank') & ...
        strcmp(Tevents.subtype,cblist{j}),:);
Tcb_t.Hour = string(Tcb_t.eventstart.Hour);
Tcb_t = timetable2table(Tcb_t,"ConvertRowTimes",false);

Tcb_tf = timetable('RowTimes',duration(0:23,0,0));

fl = unique(Tcb_t.subsubtype);

for i=1:length(fl)
    [ia,~,ic] = unique(Tcb_t(strcmp(Tcb_t.subsubtype,fl{i}),{'Hour','subsubtype'}),'rows');
    Tcb_tf = outerjoin(Tcb_tf,array2timetable(accumarray(ic,1),'RowTimes',duration(double(ia.Hour),0,0),...
        'VariableNames',fl(i)));
end
figure;
h = bar(hour(Tcb_tf.Time),Tcb_tf{:,:},1,'stacked','LineStyle','none');
set(h, {'FaceColor'}, num2cell(tempcol(1:length(fl),:),2));    
grid on    
%legend(cblist,'Location','EastOutside','NumColumns',1)
%title('Intraday Times of Central Bank Events')
legend(fl,'Location','EastOutside','NumColumns',1)
title(cblist{j})
set(gcf,'Units','centimeters', 'Position', [0 0 figsiz],'PaperUnits','centimeters','PaperSize',figsiz)
xticks(0:1:23)
xlabel('Hour of Day (GMT)')
end

%%
close all




##### SOURCE END #####
--></body></html>